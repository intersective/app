<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>practera-app-v2 documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">practera-app-v2 documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li>TodoItem</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/overview/home/home.service.ts</code>
        </p>



        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#description">description</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#meta">meta</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#name">name</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#time">time</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#type">type</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="description"></a>
                                        <span class="name"><b>description</b><a href="#description"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>description:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="meta"></a>
                                        <span class="name"><b>meta</b><a href="#meta"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>meta:     <code>literal type</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>literal type</code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="name"></a>
                                        <span class="name"><b>name</b><a href="#name"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>name:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="time"></a>
                                        <span class="name"><b>time</b><a href="#time"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>time:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="type"></a>
                                        <span class="name"><b>type</b><a href="#type"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>type:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable } from &#x27;@angular/core&#x27;;
import { Observable, of } from &#x27;rxjs&#x27;;
import { map } from &#x27;rxjs/operators&#x27;;
import { RequestService } from &#x27;@shared/request/request.service&#x27;;
import { UtilsService } from &#x27;@services/utils.service&#x27;;
import { BrowserStorageService } from &#x27;@services/storage.service&#x27;;
import { Activity } from &#x27;../project/project.service&#x27;;
import { Question, Meta} from &#x27;../../fast-feedback/fast-feedback.service&#x27;;
import { NotificationService } from &#x27;@shared/notification/notification.service&#x27;;
import { Event, EventListService } from &#x27;@app/event-list/event-list.service&#x27;;
import { SharedService } from &#x27;@services/shared.service&#x27;;

/**
 * @name api
 * @description list of api endpoint involved in this service
 * @type {Object}
 */
const api &#x3D; {
  get: {
    activity: &#x27;api/activities.json&#x27;,
    todoItem: &#x27;api/v2/motivations/todo_item/list.json&#x27;,
    chat: &#x27;api/v2/message/chat/list.json&#x27;,
    progress: &#x27;api/v2/motivations/progress/list.json&#x27;,
    events: &#x27;api/v2/act/event/list.json&#x27;,
  },
  post: {
    todoItem: &#x27;api/v2/motivations/todo_item/edit.json&#x27;
  }
};

export interface TodoItem {
  type?: string;
  name?: string;
  description?: string;
  time?: string;
  meta?: {
    activity_id?: number;
    context_id?: number;
    assessment_id?: number;
    assessment_submission_id?: number;
    assessment_name?: string;
    reviewer_name?: string;
    team_id?: number;
    team_member_id?: number;
    participants_only?: boolean;
    due_date?: string;
  };
}

@Injectable({
  providedIn: &#x27;root&#x27;
})

export class HomeService {

  currentActivityId &#x3D; 0;

  constructor(
    private storage: BrowserStorageService,
    private request: RequestService,
    private utils: UtilsService,
    private notification: NotificationService,
    private eventsService: EventListService,
    public sharedService: SharedService
  ) {}

  getTodoItems() {
    return this.request.get(api.get.todoItem, {
        params: {
          project_id: this.storage.getUser().projectId
        }
      })
      .pipe(map(response &#x3D;&gt; {
        if (response.success &amp;&amp; response.data) {
          return this._normaliseTodoItems(response.data);
        }
      }));
  }

  private _normaliseTodoItems(data): Array&lt;TodoItem&gt; {
    let todoItems &#x3D; [];
    if (!Array.isArray(data)) {
      this.request.apiResponseFormatError(&#x27;TodoItem array format error&#x27;);
      return [];
    }
    data.forEach(todoItem &#x3D;&gt; {
      if (!this.utils.has(todoItem, &#x27;identifier&#x27;) ||
          !this.utils.has(todoItem, &#x27;is_done&#x27;) ||
          !this.utils.has(todoItem, &#x27;meta&#x27;)) {
        return this.request.apiResponseFormatError(&#x27;TodoItem format error&#x27;);
      }
      if (todoItem.is_done) {
        return ;
      }

      // todo item for user to see the feedback
      if (todoItem.identifier.includes(&#x27;AssessmentSubmission-&#x27;)) {
        todoItems &#x3D; this._addTodoItemForFeedbackAvailable(todoItem, todoItems);
      }

      // todo item for user to do the review
      if (todoItem.identifier.includes(&#x27;AssessmentReview-&#x27;)) {
        todoItems &#x3D; this._addTodoItemForReview(todoItem, todoItems);
      }

      // todo item for user to see the achievement earned message
      if (todoItem.identifier.includes(&#x27;Achievement-&#x27;)) {
        this.notification.achievementPopUp(&#x27;notification&#x27;, {
          id: todoItem.meta.id,
          name: todoItem.meta.name,
          description: todoItem.meta.description,
          points: todoItem.meta.points,
          image: todoItem.meta.badge
        });
      }

      if (todoItem.identifier.includes(&#x27;EventReminder-&#x27;)) {
        // when we get a Event Reminder todo item,
        // fire an &#x27;event-reminder&#x27; event, same as when we get this from Pusher
        this.utils.broadcastEvent(&#x27;event-reminder&#x27;, {
          meta: todoItem.meta
        });
      }

      // todo item for user to submit the assessment
      if (todoItem.identifier.includes(&#x27;AssessmentSubmissionReminder-&#x27;)) {
        todoItems &#x3D; this._addTodoItemSubmissionReminder(todoItem, todoItems);
      }
    });
    return todoItems;
  }

  private _addTodoItemForFeedbackAvailable(todoItem, todoItems) {
    const item: TodoItem &#x3D; {
      type: &#x27;&#x27;,
      name: &#x27;&#x27;,
      description: &#x27;&#x27;,
      time: &#x27;&#x27;,
      meta: {}
    };
    item.type &#x3D; &#x27;feedback_available&#x27;;
    if (!this.utils.has(todoItem, &#x27;meta.assessment_name&#x27;) ||
        !this.utils.has(todoItem, &#x27;meta.reviewer_name&#x27;) ||
        !this.utils.has(todoItem, &#x27;created&#x27;)) {
      this.request.apiResponseFormatError(&#x27;TodoItem meta format error&#x27;);
      return todoItems;
    }
    item.name &#x3D; todoItem.meta.assessment_name;
    item.description &#x3D; todoItem.meta.reviewer_name + &#x27; has provided feedback&#x27;;
    item.time &#x3D; this.utils.timeFormatter(todoItem.created);
    item.meta &#x3D; todoItem.meta;
    todoItems.push(item);
    return todoItems;
  }

  private _addTodoItemForReview(todoItem, todoItems) {
    const item: TodoItem &#x3D; {
      type: &#x27;&#x27;,
      name: &#x27;&#x27;,
      description: &#x27;&#x27;,
      time: &#x27;&#x27;,
      meta: {}
    };
    item.type &#x3D; &#x27;review_submission&#x27;;
    if (!this.utils.has(todoItem, &#x27;meta.assessment_name&#x27;) ||
        !this.utils.has(todoItem, &#x27;created&#x27;)) {
      this.request.apiResponseFormatError(&#x27;TodoItem meta format error&#x27;);
      return todoItems;
    }
    item.name &#x3D; todoItem.meta.assessment_name;
    item.description &#x3D; &#x27;Please review the assessment&#x27;;
    item.time &#x3D; this.utils.timeFormatter(todoItem.created);
    item.meta &#x3D; todoItem.meta;
    todoItems.push(item);
    return todoItems;
  }

  private _addTodoItemSubmissionReminder(todoItem, todoItems) {
    const item: TodoItem &#x3D; {
      type: &#x27;&#x27;,
      name: &#x27;&#x27;,
      description: &#x27;&#x27;,
      time: &#x27;&#x27;,
      meta: {}
    };
    item.type &#x3D; &#x27;assessment_submission_reminder&#x27;;
    if (!this.utils.has(todoItem, &#x27;meta.assessment_name&#x27;) ||
        !this.utils.has(todoItem, &#x27;meta.context_id&#x27;) ||
        !this.utils.has(todoItem, &#x27;meta.activity_id&#x27;) ||
        !this.utils.has(todoItem, &#x27;meta.assessment_id&#x27;) ||
        !this.utils.has(todoItem, &#x27;meta.due_date&#x27;)) {
      this.request.apiResponseFormatError(&#x27;TodoItem meta format error&#x27;);
      return todoItems;
    }
    item.name &#x3D; todoItem.meta.assessment_name;
    item.description &#x3D; this.sharedService.dueDateFormatter(todoItem.meta.due_date);
    item.time &#x3D; this.utils.timeFormatter(todoItem.created);
    item.meta &#x3D; todoItem.meta;
    todoItems.push(item);
    return todoItems;
  }

  getChatMessage() {
    return this.request.get(api.get.chat)
      .pipe(map(response &#x3D;&gt; {
        if (response.success &amp;&amp; response.data) {
          return this._normaliseChatMessage(response.data);
        }
      }));
  }

  private _normaliseChatMessage(chatMessages): TodoItem {
    if (!Array.isArray(chatMessages)) {
      this.request.apiResponseFormatError(&#x27;Chat array format error&#x27;);
      return {};
    }
    let unreadMessages &#x3D; 0;
    let noOfChats &#x3D; 0;
    let todoItem: TodoItem;
    chatMessages.forEach(data &#x3D;&gt; {
      if (!this.utils.has(data, &#x27;unread_messages&#x27;) ||
          !this.utils.has(data, &#x27;channel_name&#x27;) ||
          !this.utils.has(data, &#x27;last_message&#x27;) ||
          !this.utils.has(data, &#x27;last_message_created&#x27;)) {
        return this.request.apiResponseFormatError(&#x27;Chat object format error&#x27;);
      }
      if (data.unread_messages &gt; 0) {
        todoItem &#x3D; {
          type: &#x27;chat&#x27;,
          name: &#x27;&#x27;,
          description: &#x27;&#x27;,
          time: &#x27;&#x27;,
        };
        unreadMessages +&#x3D; data.unread_messages;
        noOfChats ++;
        todoItem.name &#x3D; data.channel_name;
        todoItem.description &#x3D; data.last_message;
        todoItem.time &#x3D; this.utils.timeFormatter(data.last_message_created);
      }
    });
    if (unreadMessages &gt; 1) {
      // group the chat notifiations
      todoItem.name &#x3D; unreadMessages + &#x27; messages from &#x27; + noOfChats + &#x27; chats&#x27;;
      todoItem.meta &#x3D; {};
    }
    return todoItem;
  }

  getProgress() {
    return this.request.get(api.get.progress, {
        params: {
          model: &#x27;project&#x27;,
          model_id: this.storage.getUser().projectId,
          scope: &#x27;activity&#x27;
        }
      })
      .pipe(map(response &#x3D;&gt; {
        if (response.success &amp;&amp; response.data) {
          return this._normaliseProgress(response.data);
        }
      }));
  }

  private _normaliseProgress(data) {
    if (!this.utils.has(data, &#x27;Project.progress&#x27;) ||
        !this.utils.has(data, &#x27;Project.Milestone&#x27;) ||
        !Array.isArray(data.Project.Milestone)) {
      this.request.apiResponseFormatError(&#x27;Progress format error&#x27;);
      return 0;
    }

    this._getCurrentActivityId(data);

    if (data.Project.progress &gt; 1) {
      data.Project.progress &#x3D; 1;
    }
    return Math.round(data.Project.progress * 100);
  }

  private _getCurrentActivityId(data) {
    // initialise current activity id
    this.currentActivityId &#x3D; 0;
    data.Project.Milestone.forEach(this._loopThroughMilestones, this);
    // regard last activity as the current activity if all activities are finished
    if (this.currentActivityId &#x3D;&#x3D;&#x3D; 0) {
      const milestones &#x3D; data.Project.Milestone;
      const activities &#x3D; milestones[milestones.length - 1].Activity;
      this.currentActivityId &#x3D; activities[activities.length - 1].id;
    }
  }

  private _loopThroughMilestones(milestone) {
    if (this.currentActivityId &gt; 0) {
      return;
    }
    if (!this.utils.has(milestone, &#x27;Activity&#x27;) ||
        !Array.isArray(milestone.Activity)) {
      this.request.apiResponseFormatError(&#x27;Progress.Milestone format error&#x27;);
      return ;
    }
    milestone.Activity.forEach(this._loopThroughActivities, this);
  }

  private _loopThroughActivities(activity) {
    if (this.currentActivityId &gt; 0) {
      return;
    }
    if (!this.utils.has(activity, &#x27;progress&#x27;) ||
        !this.utils.has(activity, &#x27;id&#x27;)) {
      this.request.apiResponseFormatError(&#x27;Progress.Milestone.Activity format error&#x27;);
      return ;
    }
    if (activity.progress &lt; 1) {
      this.currentActivityId &#x3D; activity.id;
    }
  }

  private _normaliseActivity(data): Activity {
    if (!Array.isArray(data) ||
        !this.utils.has(data[0], &#x27;Activity.name&#x27;) ||
        !this.utils.has(data[0], &#x27;Activity.is_locked&#x27;)) {
      this.request.apiResponseFormatError(&#x27;Activity format error&#x27;);
      return {
        id: null,
        name: &#x27;&#x27;,
        isLocked: false,
        leadImage: &#x27;&#x27;
      };
    }
    const thisActivity &#x3D; data[0];
    return {
      id: this.currentActivityId,
      name: thisActivity.Activity.name,
      isLocked: thisActivity.Activity.is_locked,
      leadImage: (thisActivity.Activity.lead_image ? thisActivity.Activity.lead_image : &#x27;&#x27;)
    };
  }

  /**
   * When we get a notification event from Pusher, normalise the data to todo item and return it.
   * @param  {Obj}   event [The event data get from Pusher]
   * @return {TodoItem}       [Normalised todo item]
   */
  getTodoItemFromEvent(event): TodoItem {
    if (!this.utils.has(event, &#x27;type&#x27;)) {
      this.request.apiResponseFormatError(&#x27;Pusher notification event format error&#x27;);
      return {};
    }
    switch (event.type) {
      // This is a feedback available event
      case &#x27;assessment_review_published&#x27;:
        if (!this.utils.has(event, &#x27;meta.AssessmentReview.assessment_name&#x27;) ||
            !this.utils.has(event, &#x27;meta.AssessmentReview.reviewer_name&#x27;) ||
            !this.utils.has(event, &#x27;meta.AssessmentReview.published_date&#x27;) ||
            !this.utils.has(event, &#x27;meta.AssessmentReview.assessment_id&#x27;) ||
            !this.utils.has(event, &#x27;meta.AssessmentReview.activity_id&#x27;) ||
            !this.utils.has(event, &#x27;meta.AssessmentReview.context_id&#x27;)
          ) {
          this.request.apiResponseFormatError(&#x27;Pusher notification event meta format error&#x27;);
          return {};
        }
        return {
          type: &#x27;feedback_available&#x27;,
          name: event.meta.AssessmentReview.assessment_name,
          description: event.meta.AssessmentReview.reviewer_name + &#x27; has provided feedback&#x27;,
          time: this.utils.timeFormatter(event.meta.AssessmentReview.published_date),
          meta: {
            activity_id: event.meta.AssessmentReview.activity_id,
            context_id: event.meta.AssessmentReview.context_id,
            assessment_id: event.meta.AssessmentReview.assessment_id,
            assessment_name: event.meta.AssessmentReview.assessment_name,
            reviewer_name: event.meta.AssessmentReview.reviewer_name,
          }
        };

      // This is a submission ready for review event
      case &#x27;assessment_review_assigned&#x27;:
        if (!this.utils.has(event, &#x27;meta.AssessmentReview.assessment_name&#x27;) ||
            !this.utils.has(event, &#x27;meta.AssessmentReview.assigned_date&#x27;) ||
            !this.utils.has(event, &#x27;meta.AssessmentReview.assessment_id&#x27;) ||
            !this.utils.has(event, &#x27;meta.AssessmentReview.context_id&#x27;) ||
            !this.utils.has(event, &#x27;meta.AssessmentReview.assessment_submission_id&#x27;)
          ) {
          this.request.apiResponseFormatError(&#x27;Pusher notification event meta format error&#x27;);
          return {};
        }
        return {
          type: &#x27;review_submission&#x27;,
          name: event.meta.AssessmentReview.assessment_name,
          description: &#x27;Please review the assessment&#x27;,
          time: this.utils.timeFormatter(event.meta.AssessmentReview.assigned_date),
          meta: {
            context_id: event.meta.AssessmentReview.context_id,
            assessment_id: event.meta.AssessmentReview.assessment_id,
            assessment_name: event.meta.AssessmentReview.assessment_name,
            assessment_submission_id: event.meta.AssessmentReview.assessment_submission_id,
          }
        };

      case &#x27;assessment_submission_reminder&#x27;:
        if (!this.utils.has(event, &#x27;meta.AssessmentSubmissionReminder.assessment_name&#x27;) ||
            !this.utils.has(event, &#x27;meta.AssessmentSubmissionReminder.context_id&#x27;) ||
            !this.utils.has(event, &#x27;meta.AssessmentSubmissionReminder.activity_id&#x27;) ||
            !this.utils.has(event, &#x27;meta.AssessmentSubmissionReminder.assessment_id&#x27;) ||
            !this.utils.has(event, &#x27;meta.AssessmentSubmissionReminder.due_date&#x27;) ||
            !this.utils.has(event, &#x27;meta.AssessmentSubmissionReminder.reminded_date&#x27;)
          ) {
          this.request.apiResponseFormatError(&#x27;TodoItem meta format error&#x27;);
          return {};
        }
        return {
          type: &#x27;assessment_submission_reminder&#x27;,
          name: event.meta.AssessmentSubmissionReminder.assessment_name,
          description: this.sharedService.dueDateFormatter(event.meta.AssessmentSubmissionReminder.due_date),
          time: this.utils.timeFormatter(event.meta.AssessmentSubmissionReminder.reminded_date),
          meta: {
            context_id: event.meta.AssessmentSubmissionReminder.context_id,
            assessment_id: event.meta.AssessmentSubmissionReminder.assessment_id,
            assessment_name: event.meta.AssessmentSubmissionReminder.assessment_name,
            activity_id: event.meta.AssessmentSubmissionReminder.activity_id,
            due_date: event.meta.AssessmentSubmissionReminder.due_date
          }
        };
    }
  }

  /**
   * When we get a notification event from Pusher about event reminder, we are querying API to get the event detail and normalise it
   * @param {Obj} data [The event data from Pusher notification]
   */
  getReminderEvent(data) {
    if (!this.utils.has(data, &#x27;meta.id&#x27;)) {
      this.request.apiResponseFormatError(&#x27;Pusher notification event format error&#x27;);
      return of(null);
    }
    return this.request.get(api.get.events, {
        params: {
          type: &#x27;activity_session&#x27;,
          id: data.meta.id
        }
      })
      .pipe(map(response &#x3D;&gt; {
        if (this.utils.isEmpty(response.data)) {
          return null;
        }
        const event &#x3D; this.eventsService.normaliseEvents(response.data)[0];
        if (event.isPast) {
          // mark the todo item as done if event starts
          this.postEventReminder(event);
          return null;
        }
        return event;
      }));
  }

  postEventReminder(event) {
    return this.request.post(api.post.todoItem, {
      project_id: this.storage.getUser().projectId,
      identifier: &#x27;EventReminder-&#x27; + event.id,
      is_done: true
    }).subscribe();
  }

}
</code></pre>
    </div>
</div>


                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'TodoItem.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
