<div class="ion-padding">
  <h1 class="headline-4"
    [attr.aria-describedby]="randomCode(assessment.name)"
    role="title"
    tabindex="0">{{ assessment.name }}</h1>
  <ion-label color="green">Waiting Feedback</ion-label>
  <p class="due-date assessment subtitle-1 gray-2">
    Due date: 22 September 2023
  </p>
  <ion-text>
    <app-description content="New South Wales is Australia's oldest state. It was named in 1770 by Captain James Cook who, after falsely proclaiming that the land was uninhabited."></app-description>
  </ion-text>

  <hr>

  <ion-text class="ion-text-left">
    <app-description [name]="randomCode(assessment.name)" *ngIf="assessment.description"
      [content]="assessment.description" id="asmt-des" class="body-1 black"></app-description>
  </ion-text>

  <p class="due-date assessment subtitle-1 gray-2 ion-text-center" [ngClass]="{'over': assessment.isOverdue}"
    *ngIf="doAssessment">
    {{ this.utils.dueDateFormatter(assessment.dueDate) }}
  </p>

  <div *ngIf="!doAssessment && submission && submission.submitterName && !submission.isLocked"
    class="review-submitter ion-text-left">
    <p class="subtitle-1">
      Submitted by {{ submission.submitterName }}
    </p>
  </div>

  <div *ngIf="submission && submission.reviewerName && review && submission.status === 'published'"
    class="review-submitter ion-text-left">
    <p class="subtitle-1 gray-3">
      Reviewed by {{ submission.reviewerName }}
    </p>
  </div>

  <ion-list *ngIf="submission && submission.isLocked" class="member-detail-container no-bg" lines="none">
    <ion-item lines="none">
      <ion-avatar slot="start">
        <img [src]="submission.submitterImage ? submission.submitterImage : 'https://my.practera.com/img/user-512.png'"
          alt="submitter indicator">
      </ion-avatar>

      <ion-label>
        <p class="subtitle-1">Locked by {{ submission.submitterName }}</p>
        <p class="caption gray-2">Please wait until the user finishes editing</p>
      </ion-label>
    </ion-item>
  </ion-list>

  <form [formGroup]="questionsForm">
    <ng-container *ngIf="loadingAssessment">
      <ion-spinner></ion-spinner>
    </ng-container>

    <ng-container *ngFor="let group of assessment.groups">
      <h3 [attr.aria-describedby]="randomCode(group.name)">{{ group.name }}</h3>
      <ion-text color="dark" class="ion-text-left">
        <app-description [name]="randomCode(group.name)" class="g-description" *ngIf="group.description"
          [content]="group.description"></app-description>
      </ion-text>

      <ng-container *ngFor="let question of group.questions">
        <ion-list>
          <ion-list-header class="question-title"
            [attr.aria-label]="question.name"
            [attr.aria-describedby]="randomCode('reviewer-' + question.name)">
              {{ question.name }}
            <ion-text class="required-indicator" color="danger" *ngIf="question.isRequired">&nbsp;*</ion-text>
          </ion-list-header>

          <ion-item lines="none" *ngIf="question.info || question.description">
            <ion-icon *ngIf="question.info"
              color="primary"
              class="icon-info vertical-middle"
              (click)="showQuestionInfo(question.info)" name="information-circle-outline"
            ></ion-icon>

            <ion-text class="paragraph ion-text-left gray-2">
              <app-description
                [name]="randomCode('reviewer-' + question.name)"
                class="q-description"
                *ngIf="question.description"
                [content]="question.description"
              ></app-description>
            </ion-text>
          </ion-item>

          <ng-template *ngIf="loadingAssessment; else submissionTpl">
            <div class="ion-text-center ion-no-margin">
              <ion-spinner></ion-spinner>
            </div>
          </ng-template>
        </ion-list>

        <ng-template #submissionTpl [ngSwitch]="question.type">
          <p class="ion-padding" *ngIf="!doAssessment && (
            (!question.reviewerOnly && submission && !submission.answers[question.id]) ||
            (!doReview && question.reviewerOnly && review && !review.answers[question.id])
          )"><i>No Answer Submitted</i></p>

          <app-text *ngSwitchCase="'text'"
            [question]="question"
            [doAssessment]="doAssessment"
            [doReview]="doReview"
            [submission]="submission?.answers[question.id] || {}"
            [review]="review?.answers[question.id] || {}"
            [reviewStatus]="review ? review.status : ''"
            [submissionStatus]="submission ? submission.status : ''"
            [formControlName]="'q-' + question.id"
            [control]="questionsForm.controls['q-' + question.id]"
            (saveProgress)="submit(true)"></app-text>

          <app-oneof *ngSwitchCase="'oneof'"
            [question]="question"
            [doAssessment]="doAssessment"
            [doReview]="doReview"
            [submission]="submission?.answers[question.id] || {}"
            [review]="review?.answers[question.id] || {}"
            [reviewStatus]="review ? review.status : ''"
            [submissionStatus]="submission ? submission.status : ''"
            [formControlName]="'q-' + question.id"
            [control]="questionsForm.controls['q-' + question.id]"
            (saveProgress)="submit(true)"></app-oneof>

          <app-multiple *ngSwitchCase="'multiple'"
            [question]="question"
            [doAssessment]="doAssessment"
            [doReview]="doReview"
            [submission]="submission?.answers[question.id] || {}"
            [review]="review?.answers[question.id] || {}"
            [reviewStatus]="review ? review.status : ''"
            [submissionStatus]="submission ? submission.status : ''"
            [formControlName]="'q-' + question.id"
            [control]="questionsForm.controls['q-' + question.id]"
            (saveProgress)="submit(true)"></app-multiple>

          <app-file *ngSwitchCase="'file'"
            [question]="question"
            [doAssessment]="doAssessment"
            [doReview]="doReview"
            [submission]="submission?.answers[question.id] || {}"
            [review]="review?.answers[question.id] || {}"
            [reviewStatus]="review ? review.status : ''"
            [submissionStatus]="submission ? submission.status : ''"
            [formControlName]="'q-' + question.id"
            [control]="questionsForm.controls['q-' + question.id]"
            (saveProgress)="submit(true)"></app-file>

          <app-team-member-selector *ngSwitchCase="'team member selector'"
            [question]="question"
            [doAssessment]="doAssessment"
            [doReview]="doReview"
            [submission]="submission?.answers[question.id] || {}"
            [review]="review?.answers[question.id] || {}"
            [reviewStatus]="review ? review.status : ''"
            [submissionStatus]="submission ? submission.status : ''"
            [formControlName]="'q-' + question.id"
            [control]="questionsForm.controls['q-' + question.id]"
            (saveProgress)="submit(true)"></app-team-member-selector>
        </ng-template>
      </ng-container>
    </ng-container>
  </form>
</div>

<ion-footer color="light" class="ion-footer-absolute">
  <ion-toolbar class="ion-text-center" style="height: 100%">
    <ion-spinner *ngIf="loadingAssessment" name="dots" class="vertical-middle ion-text-center" style="width: 100%">
    </ion-spinner>
    <ng-container *ngIf="!loadingAssessment">
      <img *ngIf="savingButtonDisabled; else submitTmp" class="footer-action" src="/assets/loading.gif" alt="loading">
      <ng-template #submitTmp>
        <ion-button *ngIf="(doAssessment || doReview) && !submitting && !submitted" id="btn-submit"
          [disabled]="questionsForm.invalid" (click)="submit(false)" shape="round" fill="clear" class="footer-action">
          SUBMIT</ion-button>
      </ng-template>

      <ng-container *ngIf="footerText()">
        <span class="footer-text ion-float-left">{{ footerText() }}</span>
        <img *ngIf="continueBtnLoading || submitting; else continueTmp" class="footer-action ion-float-right"
          src="/assets/loading.gif" alt="loading">
        <ng-template #continueTmp>
          <ion-button *ngIf="!restrictedAccess" (click)="clickBtnContinue()" shape="round" fill="clear"
            class="ion-float-right footer-action">CONTINUE</ion-button>
        </ng-template>
      </ng-container>
    </ng-container>

  </ion-toolbar>
</ion-footer>

<div class="not-team ion-padding ion-text-center" *ngIf="isNotInATeam">
  <p class="black subtitle-1">Currently you are not in a team, please reach out to your Administrator or Coordinator to
    proceed with next steps.</p>
</div>

